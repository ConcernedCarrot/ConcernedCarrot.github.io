---
layout: page
title: 月別アーカイブ
permalink: /archive/
---

{%- assign posts = site.posts -%}
{%- comment -%} 年-月キー {%- endcomment -%}
{%- assign ym_list = "" | split: "" -%}
{%- for p in posts -%}
  {%- assign y = p.date | date: "%Y" -%}
  {%- assign m = p.date | date: "%m" -%}
  {%- assign ym = y | append: "-" | append: m -%}
  {%- unless ym_list contains ym -%}
    {%- assign ym_list = ym_list | push: ym -%}
  {%- endunless -%}
{%- endfor -%}
{%- assign ym_list = ym_list | sort | reverse -%}

<section class="archive-controls">
  <p>月をクリックすると該当月に投稿した記事を表示します。</p>
  <div id="monthButtons" class="month-buttons">
    {%- for ym in ym_list -%}
      {%- assign y = ym | slice: 0, 4 -%}
      {%- assign m = ym | slice: 5, 2 -%}
      <button class="month-btn" data-ym="{{ ym }}">{{ y }}年{{ m }}月</button>
    {%- endfor -%}
    <button class="month-btn month-all" data-ym="">すべて</button>
  </div>
</section>

<ul id="archiveList" class="archive-list">
  {%- for post in posts -%}
    <li class="archive-item"
        data-ym="{{ post.date | date: '%Y-%m' }}"
        data-date="{{ post.date | date: '%Y-%m-%d' }}">
      <a class="post-title" href="{{ post.url | relative_url }}">{{ post.title }}</a>
      <div class="meta">
        <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%Y-%m-%d" }}</time>
      </div>
    </li>
  {%- endfor -%}
</ul>

<script>
(function(){
  const btns = document.getElementById('monthButtons');
  const list = document.getElementById('archiveList');
  const items= Array.from(list.querySelectorAll('.archive-item'));

  function render(ym) {
    const key = (ym || '').trim();
    const filtered = items.filter(li => !key || li.dataset.ym === key);
    filtered.sort((a,b) => b.dataset.date.localeCompare(a.dataset.date));
    list.innerHTML = '';
    filtered.forEach(li => list.appendChild(li));
  }

  btns.addEventListener('click', (e) => {
    const b = e.target.closest('.month-btn');
    if (!b) return;
    btns.querySelectorAll('.month-btn').forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    render(b.dataset.ym);
  });

  // 初期表示：最新月
  const first = btns.querySelector('.month-btn');
  if (first) { first.classList.add('active'); render(first.dataset.ym); }
})();
</script>
