<!-- _includes/sidebar-taxonomy.html -->
<aside class="sidebar">
  <!-- 月別（新しい順） -->
  <section class="sb-block">
    <h3 class="sb-title">月別</h3>
    {%- assign ym_list = "" | split: "" -%}
    {%- for p in site.posts -%}
      {%- assign y = p.date | date: "%Y" -%}
      {%- assign m = p.date | date: "%m" -%}
      {%- assign ym = y | append: "-" | append: m -%}
      {%- unless ym_list contains ym -%}
        {%- assign ym_list = ym_list | push: ym -%}
      {%- endunless -%}
    {%- endfor -%}
    {%- assign ym_sorted = ym_list | sort | reverse -%}

    <ul id="sb-months" class="sb-list">
      {%- for ym in ym_sorted -%}
        {%- assign y = ym | slice: 0, 4 -%}
        {%- assign m = ym | slice: 5, 2 -%}
        {%- assign count = 0 -%}
        {%- for p in site.posts -%}
          {%- if p.date | date: "%Y-%m" == ym -%}
            {%- assign count = count | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
        <li><button class="sb-link" data-ym="{{ ym }}">{{ y }}年{{ m }}月 <span class="sb-count">{{ count }}</span></button></li>
      {%- endfor -%}
      <li><button class="sb-link sb-all" data-ym="">すべて</button></li>
    </ul>
  </section>

  <!-- タグ（件数降順→名前昇順） -->
  <section class="sb-block">
    <h3 class="sb-title">タグ</h3>
    {%- assign tag_pairs = site.tags | sort -%}
    {%- assign tag_sorted = tag_pairs | sort: "last" | reverse -%} {# 件数降順 #}
    <ul id="sb-tags" class="sb-list">
      {%- for t in tag_sorted -%}
        {%- assign name = t[0] -%}
        {%- assign posts = t[1] -%}
        <li><button class="sb-link" data-tag="{{ name | downcase | escape }}">{{ name }} <span class="sb-count">{{ posts | size }}</span></button></li>
      {%- endfor -%}
      <li><button class="sb-link sb-all" data-tag="">すべて</button></li>
    </ul>
  </section>
</aside>
